# CoinJoin：現實世界的比特幣隱私

2013年8月22日上午02:32:31

比特幣通常被提升為隱私工具，但比特幣中唯一存在的隱私來自假名地址，這些地址很脆弱，很容易通過重用，“污點”分析，跟踪付款，IP地址監控節點，網絡抓取等等來妥協。機制。一旦破壞，這種隱私很難恢復，有時也很難恢復。

傳統銀行業務默認提供相當數量的隱私。您的章程中沒有看到您購買的生育控制權剝奪了他們的大孩子，您的雇主沒有從您的薪水中了解您支持的非營利組織，而且小偷看不到您的最新購買或如何富有的你要幫助他們瞄準並欺騙你。比特幣隱私不佳對個人和企業來說都是一個主要的實際劣勢。

即使當用戶通過切換到[BIP 32地址鏈](http://bitcoinism.blogspot.com/2013/07/reclaiming-financial-privacy-with-hd.html)來結束地址重用時，他們仍然具有來自舊硬幣的隱私損失以及當他們進行更大交易時加入過去的支付。

隱私錯誤也可能造成外部化成本：您可能有良好的做法但是當您與不使用“綠色地址”的人交易時，您和您交易的每個人都會失去一些隱私。隱私權的喪失也給比特幣帶來了嚴重的系統性風險：如果隱私退化允許人們收集好的和壞的硬幣的集中列表，你可能會發現，當你真實接受的硬幣後來沒有被別人尊重時，比特幣的可替代性被破壞了當人們感到被迫用自己的硬幣強制執行流行的黑名單時。

在我寫這篇文章的時候，那些有著不明動機的人正在對舊地址上的小額付款進行下雨，可能是為了讓錢包消耗它們並創建共同地址所有權的證據。

我認為必須立即改進。

此消息描述了比特幣用戶可以用來 **顯著** 改善他們的隱私的交易風格，我一直稱之為 **CoinJoin** 。它不涉及比特幣協議的變化，並且已經看到一些非常有限的使用跨越了幾年，但它似乎沒有被廣泛理解。

我首先在一個異想天開的線程中公開描述了這種交易方式 - “ [我變得富有！](https://bitcointalk.org/index.php?topic=139581.0)“ - 我專注於這些交易的特定副作用，期望人們會看到其餘的影響。

明確的節拍隱含，甚至理解這個想法的人也有一些問題可以用來回答。這個帖子。

這個想法非常簡單，先是一些快速的背景：

![](https://ip.bitcointalk.org/?u=https%3A%2F%2Fpeople.xiph.org%2F%7Egreg%2Ftx.flow.png&amp;t=599&amp;c=808MG4YL48aToQ)

比特幣交易消耗一個或多個輸入並創建具有指定值的一個或多個輸出。

每個輸入都是過去交易的輸出。對於每個輸入，都有一個不同的簽名（scriptsig），它是根據它正在使用的過去輸出中指定的規則創建的（scriptpubkey）。

比特幣系統負責確保簽名正確，輸入存在且可用，並且輸出值的總和小於或等於輸入值的總和（任何超出部分成為支付給礦工的費用包括交易）。

交易花費很多投入以獲得足夠的價值來支付其預期的付款是正常的，通常還會產生額外的“變更”輸出以接收未花費的（和非費用的）過剩。

不要求使用的輸入的scriptpubkeys是相同的; 即，不要求他們支付到同一地址。事實上，當比特幣每次付款正確使用一個地址時，它們都不會是相同的。

在考慮比特幣所有權的歷史時，人們可以查看從多個不同的scriptpubkeys共同加入其所有權並做出假設的交易：除非共同方控制這些地址，否則交易如何從多個地址中消費？

在圖示中，“交易2”花費分配給1A1和1C3的硬幣。那麼1A1和1C3必然是同一方？

這個假設是不正確的。單個事務中的使用並不能證明是共同的控制（儘管它目前非常 **具有啟發性** ），這也是使 **CoinJoin成為** 可能的原因：

事務中的簽名（每個輸入一個） **完全相互** 獨立。這意味著比特幣用戶可以就一組要花費的輸入和一組輸出進行協商，然後單獨和單獨簽署一個交易，然後合併他們的簽名。該交易無效，在提供所有簽名之前，網絡不會接受該交易，並且沒有人會簽署不符合他們喜好的交易。

為了使用它來增加隱私，N個用戶將同意統一的輸出大小並提供至少相當於該大小的輸入。如果某些用戶提供超過目標的輸入，則該事務將具有該大小的N個輸出並且可能具有N個更多輸出。所有人都會簽署交易，然後可以傳輸交易。在任何時候都沒有被盜的風險。

在圖示中，“交易2”具有來自1A1和1C3的輸入。假設我們相信1A1是用於Alice的地址，1C3是用於Charlie的地址。Alice和Charlie中哪一個擁有1D和1E輸出？

這個想法也可以隨意使用。當您想要付款時，找一個也想要付款的人並一起進行聯合付款。這樣做並不會增加隱私，但它實際上使您的交易 *更小* ，因此在網絡上更容易（並且費用 *更低* ）; 額外的隱私是一種振作。

這種交易在外部 *與* 通過常規使用創建的交易 *無法區分* 。因此，如果這些交易變得普遍，即使是不使用它們的人也會改善隱私，因為不再輸入共同加入是共同控制的有力證據。

這種想法有很多種可能，並且所有這些都可以共存，因為這個想法不需要改變比特幣系統。讓一千朵鮮花盛開：我們可以通過各種方式實現這一目標，並學到最好的東西。

**常見問題** ：

*您是否需要使用tor或其他東西阻止每個人學習每個人的IP？*

任何希望隱藏用戶地址的交易隱私系統都應該從某種匿名網絡開始。這沒什麼不同。幸運的是，像Tor，I2P，Bitmessage和Freenet這樣的網絡都已經存在，並且都可以用於此。（然而，Freenet會導致相當緩慢的交易）

然而，弄亂“污點分析”並減少交易規模甚至不要求用戶彼此私密。所以，即使沒有像tor這樣的東西，也不會比常規交易更糟糕。

*用戶不了解哪些輸入與哪些輸出相匹配？*

在最簡單的可能實現中，用戶在IRC上進行會議等等，是的。下一個最簡單的實現是用戶將其輸入和輸出信息發送到某個會議點服務器，服務器創建該事務並要求人們對其進行簽名。服務器學習映射，但沒有其他人這樣做，服務器仍然無法竊取硬幣。

即使服務器沒有學習映射，也可能有更複雜的實現。

例如：使用chaum blind簽名：用戶連接並提供輸入（和更改地址）以及他們希望私人硬幣去的地址的加密盲版本; 服務器簽署令牌並返回它們。用戶匿名重新連接，取消隱藏其輸出地址，並將它們返回到服務器。服務器可以看到所有輸出都是由它簽名的，因此所有輸出都必須來自有效的參與者。後來人們重新連接並簽名。

使用各種零知識證明系統可以完成類似的事情。

*完全私有版本是否需要有服務器？如果它關閉怎麼辦？*

不可以。以分散的方式實現相同的隱私，其中所有用戶都充當盲簽服務器。這最終需要n ^ 2個簽名，而分佈式系統通常難以創建。我不知道是否有或者曾經有理由打擾具有完全隱私的完全分佈式版本，但它肯定是可能的。

*DOS攻擊怎麼樣？即使交易有效，也不能有人拒絕簽字？*

是的，這可以通過兩種不同的方式對DOS進行攻擊：某人可以拒絕簽署有效的聯合交易，或者有人可以在聯合交易完成之前將其輸入用於支出。

但是，如果所有簽名都沒有在某個時間限制內進入，或者創建了衝突的交易，您可以簡單地離開壞方並再試一次。使用自動化過程，任何重試對用戶都是不可見的。所以唯一真正的風險是持久的DOS攻擊者。

在非分散（或分散但非私人參與者）的案例中，獲得對DOS攻擊者的一些免疫力很容易：如果某人未能簽署輸入，則將該輸入列入黑名單。然後，他們通過創建更多經確認的比特幣交易的能力自然受到限制。

在分散系統中獲得DOS免疫力要困難得多，因為很難分辨哪個用戶實際違反了規則。一種解決方案是讓用戶在零知識證明系統下執行他們的活動，這樣您就可以確信哪個用戶是騙子，然後同意忽略他們。

在所有情況下，您都可以使用工作證明，保真綁定或其他稀缺資源使用來補充反DOS機制。但我懷疑最好能夠適應實際的攻擊，因為我們不必提前為所有用戶提供單一的安全機制。我也相信糟糕的輸入排除可以提供足夠的保護來開始。

*匿名設置大小是否受限於您在單個交易中可以獲得多少方？*

不完全的。顯然，單個交易的匿名設置大小受其中的參與方數量的限制。交易規模限制以及失敗（重試）風險意味著真正龐大的聯合交易並不明智。但由於這些交易很便宜，因此您可以級聯的交易數量沒有限制。

特別是，如果您可以為每個事務的m個參與者構建事務，則可以創建一系列m * 3個事務，這些事務形成一個三階段[交換網絡](http://en.wikipedia.org/wiki/Clos_network)，允許任何m ^ 2個最終輸出來自m ^ 2中的任何一個原始輸入（例如，使用三個階段的32個事務，32個輸入，每個1024個用戶可以加入總共96個事務）。這允許匿名設置為任何大小，僅受參與限制。

在實踐中，我希望大多數用戶只想阻止愛管閒事的朋友（和竊賊）窺探他們的財務生活，並恢復他們因地址重用等不良做法而失去的一些隱私。這些用戶可能只對一次通過感到滿意; 其他人只會機會性地運作，而其他人可能會努力實現許多通行證和大型匿名設置。一切都可以共存。

*這與[zerocoin](http://zerocoin.org/)相比如何？*

作為一個加密和計算機科學極客，我對Zerocoin非常興奮：它背後的技術非常引人入勝。但作為比特幣的用戶和開發者，將其作為改善隱私 *的* 解決方案的推廣令我失望。

Zerocoin有許多嚴重的限制：

* 它使用可能變得不安全的尖端密碼術，並且相對較少的人可以理解（例如，與ECDSA相比）。
* 它產生大的（20k字節）簽名，這會使區塊鏈膨脹（或者如果填充在外部存儲中則會產生風險）。
* 它需要一個可信方來啟動其累加器。如果該黨作弊，他們可以偷硬幣。（也許可以通過更先進的加密來解決。）
* 驗證非常緩慢（在快速CPU上可以每秒處理大約2tx），這是比特幣部署的主要障礙，因為每個完整節點必須驗證每個事務。
* 大型交易和慢速驗證也意味著代價高昂的交易，這將減少匿名設置的大小，並且可能使ZC使用對於僅僅隨意關注其隱私的隨機公眾成員不可用。
* 使用累積器，它永遠長大，沒有修剪。在實踐中，這意味著我們需要定期切換累加器以減少工作集大小，從而減少匿名集大小。如果未事先設置累加器的地平線，則可能會產生大的UTXO膨脹問題。

隨著時間的推移，隨著數學和軟件工程的改進，其中一些事情可能會有顯 

但最重要的是： **Zerocoin需要對比特幣協議進行軟分叉更改** ，所有完整節點必須採用該 **協議** ，這會將比特幣提交給特定版本的Zerocoin協議。這種情況不可能很快發生 - 可能不會在幾年內發生，特別是考慮到進一步改進算法以降低成本的潛力很大。這在政治上是有爭議的，因為一些開發商和比特幣企業非常擔心與“匿名”過度聯繫。網絡範圍內的規則變化屬於自殺協議：我們不應該，也不應該輕視它們。

**CoinJoin交易今天有效** 他們從比特幣的第一天起就開始工作了。它們與正常交易無法區分，因此除非可以阻止任何其他比特幣交易，否則不能阻止或禁止它們。

（順便說一句：ZC可能在分散的CoinJoin中用於外部比特幣，作為一種以DOS攻擊抗性方式相互盲目用戶的方法。這將允許ZC在實彈射擊下成熟而不需要花費成本或承諾特定的網絡範圍內的協議。）

我可以為ZC而不是CoinJoin做出的主要論點是，它可能提供更大的匿名設置，超出了我的加密極客的慾望。但是由於ZC的性能和擴展限制，以及使用CJ構建排序網絡事務的可能性，或者僅僅能夠使用數百個CJ事務與一個ZC事務所需的存儲和處理，我不知道哪個實際上是在實踐中產生更大的匿名集。例如，要加入1024個用戶，只需ZC兌換就會涉及20k * 1024字節的數據，相比之下不到3％的32個32路聯合交易的完整三階段級聯。雖然ZC匿名集可以更容易地跨越更大的時間跨度。

CoinJoin交易的匿名集可以很容易地讓普通用戶重新獲得他們的一些隨意隱私，而這正是我認為最有趣的。

*這與[CoinWitness](https://bitcointalk.org/index.php?topic=277389.0)相比如何？*

CoinWitness甚至比Zerocoin還要火箭，它還有許多弱點作為隱私改進者：新穎的加密，計算成本，以及需要軟叉並且今天無法使用的巨大優勢。如果它不僅僅用作隱私工具，它可能具有一些擴展優勢。但這對於這個問題來說真的太過分了，而且很快就會無法提供。

*聽起來很棒！它在哪裡？*

摩擦：沒有現成的，易於使用的軟件來做這件事。您可以使用比特幣-qt和原始事務API手動進行交易，就像我們在“豐富的”線程中所做的那樣，但為了使這成為一個實際的現實，我們需要易於使用的自動化工具。

盧克已經寫了一些[草圖，這個協議](https://gist.github.com/luke-jr/5409899)可以在普通比特幣網絡上建立聯合交易。

比特幣-qt RPC系統提供了編寫側車小程序所需的一切（包括鎖定txouts的能力，以防止它們從它下面花費）這個系統中的參與者。但是，如此眾多的用戶使用可以監視它們的集中式webwallets最終會限制這些工具的用戶群。

就個人而言，我的大部分編碼能力都花在了對我來說更重要的其他事情上。而我在比特幣上所花費的東西花費在更多的核心和安全性事物上 - 如果我在任何時候處理任何與錢包有關的東西，它很可能會改善硬幣選擇的隱私行為......但此外：

任何構建這個的人都會成為被控犯有犯罪活動的，無論是否有任何實際的犯罪分子都使用這種犯罪活動：犯罪活動成為頭條新聞。作為比特幣的核心開發者已經填補了我對此類指控的配額，特別是我的風險配額，我甚至沒有支付。![斯邁利](https://bitcointalk.org/Smileys/default/smiley.gif)

事實上，真正的罪犯如果有一點點線索就不需要CoinJoin：他們買得起 *買* 隱私以普通用戶無法做到的方式，這只是他們（通常是有利可圖的）業務的成本。

Joe-criminal可以出去買120％的PPS採礦來獲得全新的硬幣，或者通過一系列半假的高現金流賭博業務來賺錢，減少50％，他們可以負擔尋找和接口的費用這些骯髒的服務...... Joe和Jane doe？他們的名字在blockchain.info的霓虹燈上。對他們來說可能看起來不太好，但如果修復它的成本很高，他們根本就不會，因為修復它的成本非常具體，成本或隱私損失是推測性的和遙遠的。他們可能只需要放棄比特幣並切換到幾乎完全私密的東西：現金......如果要幫助他們，普通用戶需要高效且廉價的隱私。

我知道製作這樣一個工具並不適合許多比特幣業務的快速發展模式，但重要性是自我顯而易見的，最簡單的版本不需要非常深刻的技術魔法。我認為改善人們隱私的“政治”風險是一個你應該仔細考慮的真正的風險，但圍繞這些部分，我看到人們把他們的名字貼在一些相當暴躁的風險中。我希望“污點豐富”的線程足以啟發一些社區行動，但也許這將是。

所以，相反，我問 *你* ：它在哪裡？

原文：https://bitcointalk.org/index.php?topic=279249.msg2983902#msg2983902